# 简明 OpenTTD 配线教程

*WenSim, Dongfeng<sub>4</sub>3110, Mikhail, Babel, Feb.19, 2024*

<!--建议：通俗部分放前面，晦涩难懂的公式等部分放后面。我们的目标是让三岁小孩也能看懂。涉及原理的部分可以放后面，这也是我在开始写这篇文档的时候大量使用小孩式语言的原因。

目前需要考虑是否要转为LaTeX，主要是因为使用的公式（效率）不能正确显示等，另外使用LaTeX也可以帮助排版。问题是其比较难懂，而且语法规则比较复杂。我们可以采取内容提供-编排的混合工作方式。

可以使用github.dev来工作，无需liveshare等。需要github账号。
-->

*第一版*

## 前言

这篇详细解释了OpenTTD中的配线以及推荐设置。

> 我知道 OpenTTD 是什么，但是应该怎么配线呢？

首先，我们要知道——什么是配线。

配线是什么呢？配线就是铁路的布置方式。一条条铁路线在给定的沙盒里面自由铺设，好比在图纸上画画，所以我们将铁路称为线。在现实生活中，铁路线需要按照一定的规律铺设，这是为了提高铁路枢纽的效率并让管理与维护更简单。而在OpenTTD中，也有类似的需求。我们不想要杂乱无章的铁路线。


> 我想随便修建

请你现在马上离开这篇教程。诚然,OpenTTD如官方所说“不禁止玩家做傻事”但是这是一篇**正式**教程。

> 那好，我倒要看看这教程里面有什么

很好！你倒是开窍了（笑）。那让我们来看看都有什么吧。

## 目录

- 信号机
    - 路径信号机
    - 逻辑信号机
- 车站设计
    - 普通车站设计
    - 终点站与折返
    - 车辆段/车库
- 列车调度
    - 班次均匀
    - 满载命令
- 线路修建
    - 规划与曲线
    - 坡度
    - 线路规模

- 公式与原理

> 啊！怎么开始就那么复杂？可是我看到别人说……OpenTTD很简单啊！<!--谁说的Openttd很简单？>

你也许会那么想。那么，就让我们直接进入最基本的——

## 信号机基础知识

游戏里有这样几种信号机：

- 路径信号机
    - 单向路径信号机
    - 路径信号机
- 逻辑信号机
    - 入口信号机
    - 出口信号机
    - 复合信号机
    - 区间信号机

在绝大多数的情况下，你只需要用到路径信号<sup>[来源请求]</sup>。逻辑信号机，如官方所说，“只适用于特殊用途”如逻辑阵列等。让我们首先来看看他们的工作原理。

|信号种类|插图|
|---|---|
|<blockquote>路径信号机会在列车将要通过时检测列车的路径。如果信号机发现列车路径没有被占用，那么信号就会放行。如果信号机发现列车的路径上有障碍，例如另一列列车占用了这条路，信号机就不会放行。<p></p><p>打个比方，这就好比你和小明走路，小明走左边，你走右边，两个人走在同一条路上但是方向不同，这个时候就都可以欢喜地走路。</p></blockquote>|yixie dongxi|
|<blockquote>逻辑信号机，正如其名，是依靠一定的逻辑来判断的。逻辑信号机判断的“逻辑”是前方区间有没有被占用。如果前方区间被占用了，则不会予以放行。<p></p><p>这就好比你和小明走同一条路，不同方向，但是一次只能有一个人走在这条路上，因为正在这条路上行走的人占用了这条路，按照逻辑信号机的逻辑——自然是不能让另一个人通行的了。</p></blockquote>|yixie dongxi |

我们可以看到，在绝大多数的情况下，路径信号机的效率都比逻辑信号机高<sup>[来源请求]</sup>。同时路径式也容易使用。

### 路径信号机

|路径信号机|单向路径信号机|
|---|---|
|||
|常亮红灯，后面没有小牌子|常亮红灯，后面有小牌子|

正如前面所说，路径信号机是通过检测列车实际通过的路径来控制放行与否的。

我们可以看一些使用路径信号灯的例子：

|例一：车站|例二：交叉口|例三：铁路线|
|---|---|---|
|||
|这里是一个|这里是另一个|这里的例子|

我们先来看看单向路径信号机

单向路径信号机，机如其名，是**单向**的。使用单向的原因是，在设计线路的时候，我们想要在有限的空间内使效率最大化，将列车约束到一个方向上，便于管理与车站的扩建，所以会使用单向信号机。我们不想让列车从另一个方向进入。

路径信号机的情况就比较特殊了。使用路径信号机的场合相对较多。在建造车站的时候，会大量地在站台两侧使用路径信号机。一些特殊的轨道布置也会使用这种信号机。

路径信号机的特点在于，其允许列车反向越过。我们可以看这张图，显示了甲车与乙车在一个路径信号机前看到的可用区间。

我是图片

我们可以看到，甲车看到的区间范围不受路径信号灯的阻挠，这是因为甲车看不到，或者说忽略了背对着它的路径信号机。而乙车则正对着路径信号机。

这里是另外一个例子

我是图片

在这种情况下，由于丙车没有直接面对在中间的路径信号机，其看到的区间范围便是图中的四条轨道。其中三条已经被占用了，在这种情况下，丙车想要进入站台，便会驶入空余的站台。丁车看到的则是车站前咽喉区。丙车会在信号机前搜寻所有可用的站台，假如说没有或者线路被堵住了，丙车就会在信号机前等待。

### 逻辑信号机

<!--他妈的，都这个年份了还有老顽固正常用途用逻辑信号机，怎么没让2tt创死你呢-->

必须要声明的一点是，官方是明确**不支持**使用逻辑信号机的。逻辑信号机只适用于特殊场合。另外，我们**强烈不推荐**将逻辑信号机与路径信号机一同使用。
如前文所说，逻辑信号机包括这几种：

- 入口信号机
- 出口信号机
- 复合信号机
- 区间信号机

其中，区间信号机是最简单的一种。这种信号机的逻辑也是最简单的。
出口、复合、入口信号机的逻辑稍微复杂一些

|入口信号机|出口信号机|复合信号机|区间信号机|
|---|---|---|---|
|我是配图|我是配图|我是配图|我是配图|
|我是文本|我是文本|我是文本|我是文本|

使用逻辑信号机可以创建二进制计算机等，不表。不过，请一定要记住：**逻辑信号机只适用于特殊用途**。

## 车站与折返设计

在OpenTTD的世界中，车站是沟通货物与列车的桥梁。作为车站设计的一部分，折返设计很有必要着重说明。

### 车站设计

> 什么是车站？

车站是列车装卸货，变换行驶方向的路段，设有站台和相关设施，车站的线路数量往往多于铁道本身。（~~旅客是会自己上下车的货物~~）

~~如果您不知道什么是车站我建议您可以去看看生活大百科~~

在一座车站中，有这些“线”：

- 正线：连接车站与车站并直接贯穿/深入其中的线路
- 站线：站内办理作业的线路。在现实中有到发线、调车线与货物线等，但是在游戏中没有这些。我们统一将其称为到发线。你可以理解成“有站台的线路”。

根据规模，我们可以车站分成这几类：

|单线车站|复线车站|多线车站|
|---|---|---|
|我是配图|我是配图|我是配图|
|只有一条正线连接车站，具有一条或多条到发线的车站|有两条正线连接的车站|有多条正线连接的车站|

根据构造，我们可以将车站分成这几类：

|中间站|终点站|混合站|
|---|---|---|
|我是配图|我是配图|我是配图|
|“两头都通”的车站|“只通一头”的车站|“两头通一半”的车站|

#### 信号场模型

> 何为信号场模型？

信号场模型是对各种铁路场站的最一般简化，由**多条轨道**与**路径信号机**组成，用于增强通行能力的特定区间，即一个**只有铁道和信号机的系统**。

> 我们为什么引入信号场模型？

配线的重点在于合理安排铁道和信号机，因此信号场模型可以指导我们**理解配线基础规则**。

进一步地，信号场模型可以粗略反映铁路场站的吞吐量，由此能帮助我们思考如何**提升铁路的利用率**。

> 信号场模型的基本规则？

>- 轨道规则 :
>平行设置的，数量居多的铁道，一条铁道**可且仅可**容纳一列车。
>- 信号机规则 :
>信号机只能在轨道尽头，且为**单个单向路径信号机**或**一对路径信号机**。
>- 正线规则 :
>轨道尽头所连接的铁路线，只要有交叉，必视作**同属一个区间**。


*追加解释：铁道线平交视同一区间，立交视为不同区间*

---

> 如何用信号场模型表达列车容量和接发能力？

<!--这里可以挪到后面去-->

*数学建模，跳过不影响理解*

- 单行轨道：拥有一个单向信号机的轨道，为**单向**提供**1**的列车容量
- 双向轨道：拥有两个路径信号机的轨道，为**双向**各提供**1/2**的列车容量
- 简单接发能力：在指定方向上可用轨道的**列车容量之和**比上指定方向**正线数量**
> - **完整**接发能力：追加考虑正线的区间数，和**切割正线**数
>
> >$\eta_{Gen}$=$\frac {\Sigma(列车容量)}{\left[log_{\Epsilon}\Sigma(切割正线数)+\Epsilon\right]·正线数}$
>
> *常理中，$\eta_{Gen}$的值域为$\eta_{Gen}\in(0,1]$，故后文中$\eta_{Gen}$以百分数书写。*
>
> $\Epsilon$是**交分效率系数**，基本上取$\Epsilon_{Reg.}=2e$，有时候取*强调系数*$\Epsilon_{Str.}=e$
>
> 这个公式**不需要理解和记忆**，但$\eta_{Gen}$可以正确反映车站吞吐量的相对大小，只需理解对于铁路场站，该系数**愈大愈好**即可。
---

#### 单线车站

折返类型的设计与路线规模和车站规模密切相关，下作简要分类讨论。

- 单线单轨道车站

当列车运行到单线的尽头，会直接调头相反方向运行，或者继续行驶。这是车站的基本单位，下面提到的**双向站台**就是一个单线单轨道车站。
在信号场模型中，这样车站的列车容量毫无疑问是：1


- 单线多轨道车站（尽头式）

一个**对称的**2n轨道信号场可以为单线铁道提供单侧为n，双向为2n的列车容量。让我们砍掉一半，成为单行的n轨道信号场，理应为单侧提供为n的列车容量。再使列车到达后原地掉头，我们得到了一个**单线n轨道尽头站**。

每一条站线都可以看作是一座车站，这样，我们又回到上面的情况。一座**单线多轨道尽头站**列车容量为：n

值得注意的是，单线车站在一个站距内只能同时发出一列车，而发车频率不会因任何设计而改变。从这里开始，单线车站的吞吐量开始**受制于线路规模**，再介绍完通过式车站后，我们将移步至复线铁路。

- 单线多轨道车站（通过式）

上面我们讲到，尽头式车站是**半个信号场**，*如果不砍掉一半呢*？这样，我们的车站本质上是一个**对称的**多轨道信号场，列车无论通过还是折返都不会影响正常运转。单向列车容量仍为：n 而双向为：2n

- 杂项

> 单线车站的最简形态？

在上述的分析后，我们不难得出，一个能满足双向接发终到和通过列车的，最简的车站设计是这样的：

（我是图片）

> 一个轨道数量是奇数的倒霉蛋？

*由于资金和地形等诸多因素的限制，难免会出现车站轨道凑不齐偶数的情况。*当一个单线车站轨道数量为2n+1时，为了确保**双向均匀**的前提，我们可以将多出来的一条道做成**双向区间**或**通过线**，*至少我们没有浪费空间，不是么？*

> 如何满足非对称需求？

>> *北京地铁15号线的西行A快车终到“大屯路东”站，而普通车向西继续运行，假设该线路为单线，我们该怎么有效安排A快车的折返？*

我是图片1

这里的接发车情况显然不是双向均匀的，因此，我们当然可以**偏向一侧**安排站台。我们可以让3条线西行，1条线东行，或在2条对开线路的基础上干脆多加一条**专用的折返线**

我是图片2

> 如何设置通过线？

当我们希望让快车尽快通过时，我们可以设立**通过线**，（*对于单线*，有效的通过线只有一条）将一条轨道的信号灯扒光，就是这样。通过线是正线的一部分，并不属于车站。复线铁路的通过线有额外的复杂度，会另作介绍。



我们单线铁道部分的内容如上。


> 我按照样例修建了，为什么会堵车？

请参见“单向路径信号机”描述。路径信号机具有“反向透明”<sup>[来源请求]</sup>这一神奇的性质，也就是说火车会忽视前方路径上每一个背对它的普通路径信号机。因此，所有站台都使用路径信号机时，每个站台都可以接发来自两个方向的列车。一个方向上在短时内有大量列车进站，这些列车就可能会用完所有可用站台，导致在另一个方向想要进站的列车无法进站。

> 那我继续加站台不就得了？

水多加面，面多加水，在十万甚至九万次这样的循环后你的车站将会极为庞大而臃肿。

> 可是这样……有没有什么简单的解决方案呢？

解决方案相对简单，选出两个或四个站台，将信号灯一半拆除，一半改成单向路径信号灯。这样，你就将这个站台变成了**单向站台**。从对向来的车再多它们也不会使用这些站台。这样可以部分车站在通行上的顺畅。

**详情请见《铁道概论》*

现实中，车站内一般有以下几个类型的股道（线路）：

- 正线：连接车站与车站并直接贯穿/深入其中的线路
- 站线：站内办理作业的线路，包括到发线，调车线，货物线等等等等。但是由于这是神奇到没有任何调车作业的OpenTTD世界，下文中将统一用到发线代指站台。
- 段管线/岔线/特殊用途线：神奇的OpenTTD世界不需要他们，除非你是一个执着于还原国铁（指中国国家铁路集团公司）车站逆天级别配线的造景狂魔。

OpenTTD世界中的车站可以小到只有一条站线兼做正线，也可以大到把车站面积调到最大才能放下。但是这不是今天的主题。

> 谁能教教我怎么建设基础到能跑车就行的车站？

拉一条铁路，建两个车站，找个地方放个车库，买一列火车，设置好调度计划，启动火车。

现在，你已经有了一条至少能跑火车并办理运输业务的铁路。但是当你的铁路运力逐渐不够又该怎么办呢？最简单的办法当然是——

#### 加长列车

也许，你会发现，当你的列车长到站台停不下它，其装卸速度就会变得极为缓慢……这是因为，你的站台 ####长度与列车不匹配 ！
最简单的解决方案就是为你的车站留出足够长的站台（在一些联机服务器，可能会有规定要求各个玩家的车站站台长度相同以便列车过轨）。当然，延长站台所在轨道的长度也是可选办法（但是装车速度依然会十分缓慢）。

> 我的火车已经长的加不下车厢了，这时候怎么办？

好问题！对于这种情况，我推荐你——

#### 增开列车

现在，你的铁路应该还停留在非常原始的状态

|请插入yuanshidetieluxitong.png|

很明显，如果你就这样贸然增加第二列车进入系统，你的第二列车就永远卡在车库里了。或者你可以让它强行进入，然后与第一列车相撞……

为了应对这种情况，我建议您

#### 扩建车站

> 为什么扩建车站?我就不能在车站后面增加大量轨道吗？

行……但是考虑到其极低的效率与未来水多加面式的大扩张，我还是建议你扩建车站。

单线 <sup>[站与站之间只有一条铁路线链接]</sup> 铁路上，最简单的既可以满足列车交会也最省成本的车站一般长这样——

</blockquote>|请插入biaozhunzhongjianzhan.png|

如图所示，这是一座很常见的2台2线<sup>[2座站台，2条轨道]</sup>式车站。两条到发线均使用了一架单向路径信号机，使其只能接发来自一个方向的列车，因此不会出现多趟同向来车堵塞车站的问题。-->


### 折返设计简介

> 什么是折返？

折返是列车运行至路线尽头后，向反方向运行前的过程，在某些情况下，路线被认为不具有尽头（*例如灯泡线，详见下文*），因此列车折返往往涉及原地掉头(~~你游魔法魅力时刻~~)和切割其它列车运行路线，需要特别的注意以防拥堵。

*只有**列车相对路轨的方向**改变，才被算作是折返。注意，沿着铁道转圈不改变运行方向。*

折返类型的设计与路线规模和车站规模密切相关，下作简要分类讨论。

- 折返的“基本单位”

当列车运行到单线的尽头，会直接调头相反方向运行，这毫无疑问是最简单的折返，是所有折返的基本结构。但单股道折返存在一个问题，即同一条线承担双向运行。

*（**铁道路点**也可作为折返场使用）*

- 单线车站的折返

单线铁路上，每一条站线都可以看作是单股道折返站，这样，我们又回到上面的情况。一座**单线n股道尽头站**包含n个单股道折返，因此列车容量为：n

值得注意的是，单线车站在一个*站距*内只能同时发出一列车，发车频率不会随车站设计改变，在这里，单线车站的折返效率**受制于线路容量**。

上面我们讲到，尽头式车站是**半个信号场**，*那我们把两个尽头站拼起来不就是双向车站了吗？*因此通过式车站的折返效率与尽头式车站别无二致，列车容量翻倍。

在这个操作的基础上，如果有列车在通过该站后不折返，我们该怎么办呢？答案是**可以不管**，我们的车站是一个**双向均匀的**多股道信号场，拥有其一切功能。

- 路点和车库的妙用

**铁道路点**和**铁道车库**都可以**作为折返站的平替**，理论上，OpenTTD中的车库是一个股道数量无限，不分方向的~~四次元口袋~~车辆存放场，列车可以进入车库达到调头的目的，因此可以在车站后接车库作为折返线。用车库进行折返的好处之一是列车会在进出车库时**自动维护**，由此省去了在运行途中维护的时间。

- 站后折返的问题

我们先前提到的在站台就地折返并发车的都属于**站前折返**，而在列车出站方向设置车库或路点进行折返，是一种**站后折返**，列车事实上通过了车站，越过了下行的发车信号机后折返。折返后，作为一列上行进站列车**再次**越过车站开回。不难发现，如果列车从车库调头后开回，可能会撞上刚越过的单向信号机，因此，一定要确保站后折返的列车**有途径**顺利通过车站。对于规模较小的车站，将车库/路点放置在正线一旁，并添加连接所有站线的道岔组即可高效解决该问题。

我是图片

*（OpenTTD默认允许车辆原地掉头，因此站后折返增加了复杂度，且不是必须的）*

- 伪折返——灯泡线

将铁道弯折180度并汇入原有线路，列车在其上运行后也可以做到和折返相同的效果，灯泡线通常用于复线铁路，但对于单线铁路也适用，因其线型酷似（白炽）灯泡而得名“灯泡线”。灯泡线可使列车不停车换向（*因转弯半径较小难免损失一些速度*），特别适用于加速慢的重载货运列车等，在现实中还广泛应用于轻轨（此处指轨重）系统中，因其不涉及或只涉及一个单行道岔，被用以减少工程成本。

我是图片

*（OpenTTD中灯泡线在单线铁路中没什么用）*

#### 复线车站

>还记得**信号机**章节中的小明吗？现在铁路拥有两条轨道！
>
> 复线铁路一般由**对向平行**的两条轨道构成，允许大量列车连续通过，由于每条轨道都是单行的，复线铁路的列车容量在一般情况下极大。
> - 不同于单线铁路，复线铁路的区间长短在一定程度上是任意的。
> - 复线铁路**能满足多数交通线的吞吐量需求**，因此与之相关的铁路场站**最多样，最广泛**。

- 复线车站的分类思路

如前文述，复线铁路中，上下行的分离为列车折返提供了额外复杂度，足以使我们产生数倍于单线车站的分类情况。但倘若我们从下面这个车站入手，就能极大简化这个问题。

我是图片

- **完全通过式车站**：*一个理论最简的复线车站，我们将从这里开始讨论*

> 什么是完全通过式，为什么引入“场”的概念？

信号场模型中，列车的后方要么是路径信号灯，要么没有信号灯，因此可以随意折返。然而，复线铁路的各轨道是单行的，因此，虽然信号场模型仍然使用，列车不能像单线车站一样——除非它有办法去到对侧正线上——在任意位置折返并开回正线。
如果列车没有办法去到对侧正线，这便是完全通过式车站了。这样的一个车站，不难看出，上下行轨道完全分离。

分离的两部分被称为一个铁路场，简称为“场”，场是部分具有近似功能的轨道的集合。铁路场往往彼此完全或部分分离，在这里，该车站被分为上行场和下行场。

我是图片

因为列车只能单向通过，轨道上必是顺方向的一枚单向路径信号机，也因此为所在方向提供1的列车容量。，进一步地，在接发需求对称的情况下，上下行场各有n条轨道的车站提供n的列车容量。<br>据此易得$\eta_{Gen}$=100%，可见，在所有列车都停靠的情况下，这是理论效率最高的复线车站。

> 如何扩展这个车站？

只需按顺序在上下行场增加轨道数即可，这样的操作提升了列车容量，且不妨碍$\eta_{Gen}$仍为100%，但由于一个场的所有轨道都汇聚于同一条正线，当轨道数量高于复线铁路的容量后，就毫无意义了。

*（信号场模型中的列车容量在复线铁路中意义不大，列车只要不是极端多，一般可认为复线铁路的列车容量是无穷大的）*

> 为了解决折返问题，我们做出了什么妥协？

假设上述车站为该路线上部分列车的终点站，列车需要掉头后前往**对侧正线**，从一侧轨道前往对侧正线必然会先经过本侧正线。让我们添加一条连接两条正线的轨道。<br>这样的路径被称作**切割正线**，体现为与其他正线上行驶的车辆路径相交（且通常不相接），事实上与其他车辆相互阻挡，影响了通行效率。

我是图片

> 如果用跨线桥绕到对面，是否可以避免切割正线？

很遗憾，跨线桥在这里不起任何作用。从信号场模型来理解，列车在进入平行轨道前的全部部分都属于正线区间（“一个区间”原则），进入这个区间又离开，必然是切割正线，与具体走什么路径无关。

我是图片

> 这是否是唯一的方案，我们损失了多少效率？

通过计算，对下图这个车站中同时接发通过和折返列车的情况而言，$\eta_{Gen}$=90%，若对侧也有渡线，则$\eta_{Gen}$=84%，话虽如此，但如果折返列车不多，总体的效率仍接近理想的100%。经过这样的改进，我们的车站能够接发双向的通过和折返列车，成为理论上最简的**一般通过式车站**。

我是图片1 箭头 我是图片2

- **一般通过式车站**

## 线路修建

线路是沟通车站的手段。得益于游戏的开放性，玩家可以在游戏中修建过山车式轨道。不过，为了最小化成本与最大化效益，在修建线路时进行适当的规划很有必要。

线路的规划应当结合线路类型、线路上的机车类型、当前时代机车功率、途径城镇、途径工业等综合考虑。在修建综合式客货混合运行线路时更应着重考虑机车类型等对线路运营的影响。

### 前期规划

在规划的时候，我们要考虑未来是否要对线路进行扩建，以及是否要在目前线路附近新建线路。

> 我们推荐使用`Planning Tracks`这款 NewGRF 来进行规划工作。在规划完成之后使用轨道转换工具来转换轨道。其他的景观性轨道也可以用来进行轨道规划工作。

在前期规划的时候，我们应当结合这些因素综合考虑线路走向：

|项目|说明|
|---|---|
|线路类型|货物线考虑综合效率，客运线更考虑线路里程与速度|
|机车类型|电力机车的功率显著大于内燃机车，在电力机车内部又分不同的供电制式，相应地，电气化轨道的造价也显著高于非电气化轨道，其中需要取舍|
|机车功率与功率/重量比|功率重量比是$\frac{P}m$ （保留单位），这个比值越大，整列车的加速性能就越好，相应地，线路的坡度就可以留大一些。详情请见子表。这一项对货物列车的影响尤其大。|
|沿线城镇与工业|线路主要服务是客运还是货运？应当围绕线路最主要的功能选择线路经过的城镇和工业|
|运营模式与速度|线路形态会制约线路的规模和速度，如果线路未来有升级的可能，就应该确保线路周边有足够的空间|

### 坡度

如前文所说，玩家可以在游戏中修建过山车式轨道。但是我们不提倡修建这种线路。这种线路缺乏逻辑性与效率，在经验玩家看来是人体部分机制出现错误的表示。

|错误示例|错误示例|正确示例|
|---|---|---|
|我是图片|我是图片|我是图片|
|~~禁止拿RCT2过山车图片滥竽充数~~|理论上可行，实际上列车在这种轨道上面运行效率会大打折扣|正确示例|



### 线路规模

